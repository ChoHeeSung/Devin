## 교 통 관 제   시 스 템   재 구 축   공 사 인터페이스  설계서(VDS)

2024. 02.

## 개 정 이 력

|   No | 버전    | 변경일     | 변경 내용   | 작성자   | 승인자   |
|------|---------|------------|-------------|----------|----------|
|    1 | Rev.1.0 | 2024/02/14 | 최초작성    | 진해리   |          |

## 목   차

| 1.   | 차량 검지 시스템 개요·································································································································· 1 프로토콜 개요·································································································································· 1 2.  VDS   |
|------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|      | 1                                                                                                                                                                                                                                                                                                                     |
|      | 세션 관리·················································································································································· 2.1                                                                                                                                                       |
|      | 메시지 종류·············································································································································· 2.2  2                                                                                                                                                      |
| 3.   | 통신 흐름도······················································································································································ 3                                                                                                                                                   |
|      | 전체 흐름·················································································································································· 3.1  3                                                                                                                                                    |
|      | 수집서버의 서버 포트···························································································································· 4 3.2                                                                                                                                                                |
|      | 제어기와 수집서버간 TCP 접속··········································································································· 4 3.3                                                                                                                                                                         |
|      | 연결 수립 이후의 제어기 확인과정··························································································· 4 3.4  TCP                                                                                                                                                                                |
|      | 제어기와 수집서버간 요청 응답 메시지 처리·················································································· 5 3.5  /                                                                                                                                                                                  |
|      | 제어기와 수집서버간 통신 유효성확인 메시지 처리······································································ 7 3.6                                                                                                                                                                                           |
| 4.   | 프로토콜 패킷 구성········································································································································ 8                                                                                                                                                          |
|      | 패킷 헤더 필드 목록 및 구성 정보·································································································· 10 4.1                                                                                                                                                                             |
|      | 요청 메시지의 데이터부 공통 필드·································································································· 14 4.2                                                                                                                                                                             |
|      | 응답 메시지의 데이터부 공통 필드·································································································· 15 4.3                                                                                                                                                                             |
|      | 명령어 코드 별 패킷 구성·················································································································· 17 4.4                                                                                                                                                                     |

## 차량 검지 시스템 개요 1.

차량검지 시스템은 도로상에서 시시각각으로 변하는 교통정보를 실시간으로 수집하 기 위한 것으로 교통량(Volume), 속도(Speed), 점유율(Occupancy), 그리고 평균차량길이 를 실시간으로 수집하여 중앙장치로 전송하는 시스템을 일컫는다 본 문서에서는 이러 . 한 차량검지 시스템으로부터 교통정보를 수집하고 제어하기 위한 각종 명령어에 대한 규격을 정의하고자 한다.

## 프로토콜 개요 2.  VDS

제어기는 수집서버와 TCP/IP 연결을 이용하여 통신을 한다. VDS 제어기가 최초 VDS 에 TCP연결 요청을 시작하고 수집서버와 연결이 완료된 이후에는 수집서버의 정보제공 및 제어 요청에 대해서 VDS 제어기가 응답을 하는 형태로 통신이 이루어진다.

프로토콜은 수집서버와 VDS 제어기간 요청 메시지와 응답 메시지를 교환하는 것을 기본으로 하는 오퍼레이션들과 그와 관련된 데이터부분들에 대한 내용을 규정한다 즉, . 대부분의 오퍼레이션에 대해서 요청메시지에 대한 응답 메시지가 존재하며 요청 메시지 를 수신하는 VDS 제어기 측에서는 반드시 응답 메시지를 수집서버로 보내야 한다.  다 만 일부 오퍼레이션에 대해서는 예외적으로 응답메시지가 존재하지 않을 수 있다. ,

## 세션 관리 2.1

제어기가 수집서버로 TCP연결 요청을 하면서 세션은 시작된다.  TCP 연결이 수립 VDS 된 상태에서 수집서버와 제어기간 인증절차가 처리되면 비로소 정상적인 통신수립상태 가 완료된다 이러한 세션 상태에 대해 다음과 같이 정의하도록 한다. .

## ▣ OFFLINE

제어기와 수집서버간 TCP 연결이 끊어졌거나 연결되지 않은 상태를 말한다. VDS

## ▣ INIT

제어기와 수집서버간 TCP 연결이 수립된 상태이고 인증절차를 거치지 않은 상태를 말한다. VDS , 이 상태에서는 수집서버에서  인증확인을 위한 오퍼레이션을 담은 요청명령이 제어기로 전달되고 ' ' 제어기는 그에 상응하는 응답메시지를 수집서버로 전달해야만 한다.

## ▣ ONLINE

제어기의 TCP접속과 함께 인증확인까지 완료된 상태를 말한다 이 상태에서 교통정보 수집 및 VDS . 제어관련 오퍼레이션이 가능하다.

## 메시지 종류 2.2

검지기와 수집서버간 교환되는 메시지의 종류는 크 게 다음과 같은 종류로 구분 VDS 된다.

## ▣ VDS 인증

초기 접속 시 제어기 구분을 위한 명령어.

## ▣ VDS 동 화 기

제어기와 서버간의 시간 동 화 기 를 위한 명령어.

## ▣ 정보 수집

교통 데이터교통량 속도 점유율 길이 수집을 위한 명령어. ( , , , )

## ▣ 파라미 터 제어

검지기에 관련된 각종 동 작관련 파라미 터에 대한 제어 명령어.

과 달리 TCP 검지기는 초기 설치 시 파라미 터들(LOOP 개수 및 차 선 정보 등 을 de aul  로 # Se ri al ...) f t 가지고 동 작해야 한다.

## ▣ 장비 제어

초기 , 리 화 셋 등 의 장비에 대한 제어 명령어.

## ▣ 상태정보 수집

장비의 상태정보 수집 명령어. H W /

## ▣ 기능 점검

메 리 확인 버전정보 확인 에코 점검 모 등 의 기능 확인을 위한 제어 명령어 , ,

## ▣ 통신세션 유효성 확인

장비가 서버와의 세션상태를 점검하기 위해 전송하는 명령어 VDS

## 통신 흐름도 3.

## 전체 흐름 3.1

그  5 제어기 와 수집서버간 데이터 흐름 림

과 달리 TCP 검지기는 초기 설치 시 파라미 터들(LOOP 개수 및 차 선 정보 등 을 de aul  로 # Se ri al ...) f t 가지고 동 작해야 한다 즉 서버에서 초기 통신 연결 시 파라미 터들을 자 동 으로 다 운 로드 하지 않는 . 다.

## 수집서버의 서버 포트 3.2

 TCP Se ve  Po r r rt 30100 :

## 제어기와 수집서버간 TCP 접속 3.3

그 림 6  제어기 수집서버간 TCP 연결 흐름도 -

-  제어기가 수집서버로 TCP 연결 요청을 보내고 수집서버가 이를 받아 들이는 TCP연 VDS 결수립의 기본흐름을 따른 다.(3 -w ay h and sh k a e)
-  이 단 계만으로는 어 떤 제어기가 접속 했 는지 확인 할 수 없 기 때 문에 아래 의 단 계를 진 행 한다.

## 연결 수립 이후의 제어기 확인과정 3.4  TCP

그 림 7  TCP연결 수립 후 제어기 확인 흐름도

- (1) 연결이 완료된 후 수집서버에서는 제어기를 확인하기 위해 CSN(Con olle  S a on Num e ) TCP , tr r t ti b r 확인 요청을 전송한다.
- (2) 제어기에서 CSN을 수집서버로 보내면서 서버상에서 제어기를 확인하 게 된다.
- (3) 시스템에 등 록된 CSN인 경 우 에만 정상적인 통신이 이 뤄 게 지  된다.

## 제어기와 수집서버간 요청 응답 메시지 처리 3.5 /

그 림 8  제어기 수집서버간 요청 응답 메시지 흐름도 -/

- (1) 요청 메시지는 수집서버에서 제어기로만 전송된다.
- (2) 수집서버에서 전송된 요청 메시지에 대해서 제어기는 그 응답 메시지가 준 비되면 수집서버로 전 송한다.

- (3) 단 세션유효성 확인을 위한 메시지는 제어기에서 수집서버로 전송된다. ,
- (4) 요청 메시지에 대한 응답 메시지가 수집서버로 전송되지 않은 상태에서도 수집서버에서는 또 다 른 요청 메시지를 전송 할 수 있으며 이에 대해 제어기는 응답 메시지가 준 비되는 대로 수집서버 , 로 전달해야 한다.
- (5) 수집요청 메시지에 대해 제어기가 정해진 시간 내에 응답을 하지 않으면 수집서버는 타임아웃 처 리를 하고 이후에 도 착할 수도 있는 응답 메시지는 버리도록 한다. ,
- ① 수집요청에 대한 응답 대기시간은  초로 한다. 5
- (6) 수집요청을 제외한 제어요청 메시지에 대해 제어기가 정해진 시간내에 응답하지 않으면 수집서버 는 재요청을 하고 정해진 재요청 회 수를 초과하면 접속을 종료한다. ,
- ② 응답 대기 시간은  초로 한다. 5
- ③ 재요청 제한 회 수는 2 회 로 한다. ( 총 회 3 까지 요청)

그 림 9 비 동 기적 요청 응답 메시지 흐름 /

그 림 10  수집요청 메시지에 대한 타임아웃 처리 흐름

## 제어기와 수집서버간 통신 유효성확인 메시지 처리 3.6

그 림 11  유효성 확인 메시지 흐름

- (1) 서버로부터 최종 메시지를 받 은 이후  분간 아무런 메시지 전송이 없 을 경 우 제어기는 5 수집서버로 통신유효성 확인(0 18)메시지를 보 낸 다. x
- (2) 서버는 0 18 메시지의 응답으로 유효성확인 응답을 보 낸 다. x

## 프로토콜 패킷 구성 4.

수집서버에서 제어기로 전송되는 메시지 프레 임 은 고정길이를 가지는 헤더부와 헤더 내의 명령어 코드에 따라 가변길이를 가지는 데이터부로 구성된다.

따라 서 헤더부에는 데이터에 대한 길이 정보를 갖 는 필드를 가지고 있다. 호 스트 간 , 통신 시에는 고정된 길이의 헤더부를 먼저 수신하고 데이터부 길이를 확인한 후에 데이 , 터 수신을 처리해야 한다.

또 한, 모든 패킷에 걸쳐 바 이트 정 렬 은 네 워 트 크 정 렬 (Ne tw o rk O de r ri n g: BigEnd an) i 을 따라 야 한다.

패킷을 구성하는 각 필드들에 대한 데이터 형과 그 길이를 표 시함에 따른 표 기 은 다 법 음과 같이 정하며 본 문서는 이러한 표 법 기 에 따라 작성되어 있다. ,

## ▣ 필드 타입 종류

| 타입 코드   | 설명                                                                                                                                                        |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| N           | 정수형. 1,  2,  혹 은 4 바 이트 길이를 가진다. (간 혹   8 바 이트 길이 정 수형을 사용 할   수  있으나,  본  문서(VDS  프로토콜 1.0)에서는 다루 지 않는다.   |
| C           | 문자 로 된 필드에 사용되며, N LL를  포함하지  않는다.  다만 필 열 U ,  드 길이보다  짧 은 정보를 설정 할   경 우 에  빈   부분은 N 로 설정 될 U LL 수 있다. |
| B           | 바 이트  단 위  혹 은 비트 단 위로 다루어지는 필드에 사용된다                                                                                               |

## ▣ 필드 길이

정수형 숫 자로 표 시되는 것이 일반적이며 가변길이를 표현할 경 우 에는 다음과 같이 표현 한다. ,

| 표 기   | 설명                           |
|---------|--------------------------------|
| [ N ]   | 바 이트의 길이를 가지는 필드 N |

## ▣ 데이터 크기 표현 방식

데이터의 크기를 표 시하는 방법 은 방식 을 따른 다. Big\_ End an i

- 예 데이터가 16진수 0 12345678 이고 메 모 리의 선두번 지가 0 1000일 경 우 ) x , x

| 번 지    | 데이터   |
|----------|----------|
| 0 1000 x | 0 12 x   |
| 0 1001 x | 0 34 x   |
| 0 1002 x | 0 56 x   |
| 0 1003 x | 0 78 x   |

## 패킷 헤더 필드 목록 및 구성 정보 4.1

프로토콜 패킷을 구성하는 헤더부분은 아래 와 같다.

|   NO | 필드명                          | 타입   | 길이   | 비고   |
|------|---------------------------------|--------|--------|--------|
|    1 | SENDER IP                       | C      | 16     |        |
|    2 | DESTIN A TION IP                | C      | 16     |        |
|    3 | CONTROLLER  K IND               | C      | 2      |        |
|    4 | CONTROLLER  ST A TION  N UMB ER | N      | 4      |        |
|    5 | TOT A L  LEN G H T              | N      | 4      |        |
|    6 | OPCODE                          | N      | 1      |        |
|    7 | D T A A   FIELD                 | B      | [ N ]  |        |

## (1) SENDER IP

송신지 IP를 설정한다. IP버전에 따라 설정 법 은 다음과 같다.

- ① 의  경 우 는 아래 와  같이 문자를  사용하여 채운 다.( 빈 자리는 IPv4 010.100.100.025 A SCII 로 채운 다) ' -' (0 2D) x
- ② 의 경 우 에는 16 바 이트 모두 바 이 리 너 값 으로 채운 다. IPv6

## (2) DESTIN TION IP A

목적지 IP를 설정한다. IP버전에 따라 설정 법 은 다음과 같다.

- ① 의  경 우 는 아래 와  같이 문자를  사용하여 채운 다.( 빈 자리는 IPv4 010.100.100.025 A SCII 로 채운 다) ' -' (0 2D) x
- ② 의 경 우 에는 16 바 이트 모두 바 이 리 너 값 으로 채운 다. IPv6

## (3) CONTROLLER K IND

제어기 종류를 구분하기 위한 식 별자로 다음과 같이 정의되어 있다.

| 제어기 구분   | 코드   | 비고   |
|---------------|--------|--------|
| VDS           | VD     |        |

## (4) Con tr olle   S a r t ti on Num e (CSN) b r

제어기별로 부여되는 4 바 이트 길이의 정수 값 이며 다음과 같이 구성된다. ,

|   NO | 필드             | 타입   |   길이 | 비고   |
|------|------------------|--------|--------|--------|
|    1 | 그 코드 룹       | B      |      2 |        |
|    2 | 제어기 일련 번호 | B      |      2 |        |

## ① 그 코드 룹

 고속도로에 부여되어 있는 노선번호 를 사용한다.

| 노선 명               |   노선번호 | 노선번호   | 노선 명              |   노선번호 | 노선번호   |
|-----------------------|------------|------------|----------------------|------------|------------|
| 경부 선               |       0010 | 0 000 x A  | 중부내 륙선          |       0450 | 0 01C2 x   |
| 중부 선               |       0352 | 0 0160 x   | 제 중부 선 2         |       0370 | 0 0172 x   |
| 판 - 교 구리          |       1001 | 0 03E x 9  | 남 해제 지 선 1      |       1020 | 0 03FC x   |
| 호남선 선 지          |       2510 | 0 0 x 9 CE | 평 택충주선          |       0400 | 0 01 x 9 0 |
| 경인 선               |       1200 | 0 04 x B 0 | 천안논산 선          |       0252 | 0 00FC x   |
| 제 경인 선 2          |       1100 | 0 044C x   | 대구포 항선          |       0200 | 0 00C8 x   |
| 영동선                |       0500 | 0 01F4 x   | 대구 부산 선 -       |       0552 | 0 0228 x   |
| 동 선 해              |       0650 | 0 028 x A  | 고 담 창 양선        |       0140 | 0 008C x   |
| 호남선                |       0251 | 0 00F x B  | 무 광주선 안         |       0121 | 0 007 x 9  |
| 남 선 해              |       0100 | 0 0064 x   | 청 상 원 주선        |       0300 | 0 012C x   |
| 중부내 지 륙 선       |       4510 | 0 11 x 9 E | 서 외 울 곽순 선 환  |       1000 | 0 03E8 x   |
| 올림픽선 88           |       0120 | 0 0078 x   | 익 산장수 선         |       0201 | 0 00C x 9  |
| 서해안 선             |       0150 | 0 00 x 9 6 | 부산 산 울 선        |       0651 | 0 028 x B  |
| 중앙 선               |       0550 | 0 0226 x   | 인천 제공 국 항선    |       1300 | 0 0514 x   |
| 중부 선 대전통 ) 영 ( |       0351 | 0 015F x   | 당 진대전 선         |       0301 | 0 012D x   |
| 판 - 교 일산          |       1003 | 0 03E x B  | 서천공 주선          |       1510 | 0 05E6 x   |
| 중앙 선 선 지         |       5510 | 0 1586 x   | 서 울양양선          |       0600 | 0 0258 x   |
| 울 선 산              |       0160 | 0 00 x A 0 | 인천대교 선          |       1102 | 0 044E x   |
| 대전 남 순 부 환 선   |       3000 | 0 0 x BB 8 | 수도 제2 권 순 선 환 |       4000 | 0 0F x A 0 |
| 남 해제 지 선 2       |       1040 | 0 0410 x   | 평 택화 성 선        |       0170 | 0 00 x AA  |

## ② 제어기 일련 번호

-  노선 상에 설치되어 있는 제어기별로 할당 되어 있는 일련 번호 이며 이 번호 로 하나의 노선 , 상에 설치되어 있는 제어기들을 구별 할 수 있 게 된다.

제어기에서 최초 TCP 접속 시 이 번호 를 이용하여 인증과정을 거치 게 되고, 동 일 CSN을 가진 제 어기가 수집서버로 접속하 게 되면 기존의 접속을 종료하 게 된다.

번호 생 성 방법 은 다음과 같다. CSN

- ① 바 이트 정수형으로 취급 하기 위해서 상위2 바 이트는 그 룹 코드를 하위2 바 이트는 제어기 일 4 , , 련 번호 를 할당 한다.

## (5) TOT L LEN A G H T

와 D T  FIELD를 합 한 길이 정보이다. OPCODE A A

## (6) 운영 코드(OP code)

검지기를 제어하거나 정보 수집 등 을 처리하기 위한 명령어 코드. VDS

| 지 원   | 버전   | 코드          | 설명                        | 방향           |
|---------|--------|---------------|-----------------------------|----------------|
| 1.0     |        | 0 FF x        | 요청 CSN                    | 서버  제어기 → |
| 1.0     |        | 0 FF x        | 응답 CSN                    | 서버  제어기 ← |
|         |        | 0 01 x        | 제어기  동 기 화   요청     | 서버  제어기 → |
|         |        | 0 04 x        | 교통 데이터 요구            | 서버  제어기 → |
|         |        |               | 교통 데이터 응답            | 서버  제어기 ← |
|         |        |               | 속도 데이터 요구            | 서버  제어기 → |
|         |        | 0 05 x        | 속도 데이터 응답            | 서버  제어기 ← |
|         |        | 0 06 x        | 차량길이 데이터 요구        | 서버  제어기 → |
|         |        |               | 차량길이 데이터 응답        | 서버  제어기 ← |
|         |        | 누            | 적 교통량 데이터 요구       | 서버  제어기 → |
|         |        | 0 07 x        | 누 적 교통량 데이터 응답    | 서버  제어기 ← |
|         |        | 0 08 x        | 교통상태  임 계치 지정 요청 | 서버  제어기 → |
|         |        |               | 교통상태  임 계치 지정 응답 | 서버  제어기 ← |
|         |        |               | 제어기  상태정보 요청 H W / | 서버  제어기 → |
|         |        | 0 0 x B       | 제어기  상태정보 응답 H W / | 서버  제어기 ← |
|         |        |               | 제어기 리 셋   요청         | 서버  제어기 → |
|         |        | 0 0C x        | 제어기 리 셋   응답         | 서버  제어기 ← |
|         |        | 0 0D x        | 제어기 초기 화   요청       | 서버  제어기 → |
|         |        |               | 제어기 초기 화   응답       | 서버  제어기 ← |
|         |        |               | 파라미 터 다 운 로드 요청   | 서버  제어기 → |
|         |        | 0 0E x 파라미 | 터 다 운 로드 응답          | 서버  제어기 ← |
|         |        | 파라미 터  업 | 로드 요청                   | 서버  제어기 → |
|         |        | 0 0F x        | 파라미 터  업 로드 응답     | 서버  제어기 ← |
|         |        | 온라          | 인 상태 요청                | 서버  제어기 → |
|         |        | 0 11 x 온라   | 인 상태 응답                | 서버  제어기 ← |
|         |        | 메 모         | 리 상태 요청                | 서버  제어기 → |
|         |        | 0 12 x 메     | 모 리 상태 응답             | 서버  제어기 ← |
|         |        | 0 13 x        | 메시지 에코 요청            | 서버  제어기 → |
|         |        |               | 메시지 에코 응답            | 서버  제어기 ← |

| 0 14 x   | 일련 번호   전송 요청     | 서버  제어기 →   |
|----------|---------------------------|------------------|
| 0 14 x   | 일련 번호   전송 응답     | 서버  제어기 ←   |
| 0 15 x   | 버전 요청 VDS             | 서버  제어기 →   |
| 0 15 x   | 버전 응답 VDS             | 서버  제어기 ←   |
| 0 16 x   | 개별 차량 데이터 요청     | 서버  제어기 →   |
| 0 16 x   | 개별 차량 데이터 응답     | 서버  제어기 ←   |
| 0 17 x   | 정지 상 요청 영           | 서버  제어기 →   |
| 0 17 x   | 정지 상 응답 영           | 서버  제어기 ←   |
| 0 18 x   | 통신세션 유효성확인 요청  | 서버  제어기 ←   |
| 0 18 x   | 통신세션 유효성확인 응답  | 서버  제어기 →   |
| 0 1 x 9  | 역주행   검지확인 요청    | 서버  제어기 ←   |
| 0 1 x 9  | 역주행   검지확인 응답    | 서버  제어기 →   |
| 0 20 x   | 정차차 랑   검지확인 요청 | 서버  제어기 ←   |
| 0 20 x   | 정차차 랑   검지확인 응답 | 서버  제어기 →   |

응답메시지인 경 우 에도 동 일한 명령어코드를 사용한다.

## (7) D T  FIELD A A

운영 코드와 요청 응답일 경 우 에 따라 패킷에 추 가되는 정보 필드이다. /

## 요청 메시지의 데이터부 공통 필드 4.2

요청 메시지의 경 우 다음의 필드는 항 상 존재하 게 된다. ,

| 항 목                       | 타입   |   길이 | 값   | 비고   |
|-----------------------------|--------|--------|------|--------|
| T an ac r s ti on Num e b r | B      |      8 |      |        |

## (1) T an ac r s ti on Num e b r

수집서버와 제어기간 통신되는 메시지들을 구분하기 위한 식 별자이며 다음과 같이 구성된다. ,

| 필드                  | 타입   |   길이 | 비고   |
|-----------------------|--------|--------|--------|
| 트 랜잭 션  발생 시간 | N      |      4 |        |
| 메시지  번호          | N      |      4 |        |

- ① 트 랜잭 션 발생 시간  TC 시간 정보초). : U (
- ② 메시지 번호: 메시지 다 부여되는 정수 마 값 의 번호 이며, 0 범 위를 가진다 최대 값 ~ x 0 7FFFFFFF . 에 이 르 면 다시  을 부여하 게 된다. 0

수집서버에서 ID를 생 성하며 제어기에서는 요청메시지에서 받 은 값 을 그대로 응답메시지에 사용 , 하면 된다.

## 응답 메시지의 데이터부 공통 필드 4.3

## 응답 메시지의 경 우 다음의 필드는 항 상 존재하 게 된다. ,

| 항 목                       | 타입   |   길이 | 값                                | 비고   |
|-----------------------------|--------|--------|-----------------------------------|--------|
| T an ac r s ti on Num e b r | B      |      8 |                                   |        |
| Re ul   Code s t            | N      |      1 | 범 위의 정수  값 0  ~   0 x FF  . |        |
| 제어기 상태                 | B      |      2 | 비트 별로 장비상태에 대한         |        |

## (1) T an ac r s ti on Num e b r

수집서버의 요청메시지 패킷에 포함되어 있 던 값 을 응답메시지에서 그대로 사용한다. 수집서버가 이 값 을 사용하여 어 느 요청메시지에 대한 응답인지를 구분하 게 된다.

## (2) 명령 수 행 결과에 대한 코드 값 Re ul  Code s t : .

| 코드            | 오류사유                                                         | 비고   |
|-----------------|------------------------------------------------------------------|--------|
| 0 00 x          | 정상 수 행                                                       | A K C  |
| 0 01 x          | 내부 시스템 장 애 로 인한 수 행 실패                             | N AK   |
| 0 02 x          | 가    잘못 된 경 우 OP code .                                    | N AK   |
| 0 03 x          | 값 이  잘못 된 경 우 CSN(Con tr olle   S a r t ti on Num e ) b r | N AK   |
| 0 04 x          | 데이터 길이 정보가  잘못 된 경 우                                | N AK   |
| 0 05 x          | 필드  값 범 위 초과되 었 거나 정의된  값 이  아닌   경 우 .      | N AK   |
| 0 06 x          | 요청된 데이터가  준 비되지 않음                                  | N AK   |
| 0 07 x          | 트 랜잭 션  타임아웃 발생 함.                                    | N AK   |
| 0 08 0 FF x - x | 특 성에  맞게   정의함) Re e ved( s r                            |        |

## (3) 제어기의 상태에 대한 비트설정 값 S a u t t s: .

|   비트 | 의 미                                                                                                                                                            |
|--------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|      0 | 초를 초과한 시간  동 안 PO 이  발생 한 경 우 Lon g   Po w r e   Fa l.  2 i W ER   F A IL 로 설정. 1                                                              |
|      1 | 초 이하의 시간  동 안 PO 이    발생 한 경 우   1로  S h o rt   Po w r e   Fa l.2 i W ER F A IL 설정.                                                             |
|      2 | 파라미 터 R 이 기본 값 을 가지고   있어,  로부터  De aul   Pa ame e .  f t r t r AM H OST 파라미 터 다 운 로드가 필요한 경 우   1로   설정.                      |
|      3 | 동 기 화   명령은 제외).  로부터 전 역주 소  Rece ved    i Br oadca st M ss g e a e( H OST 를 수신한 경 우   1로 설정. 0 FFFFFFFF x                              |
|      4 | 로부터 S NC 명령을  받 지  못 한 경 우 A t u o Re ync s hr on iz a ti on.  H OST Y ,  일정시간 이후 기본 초 제어기 스스로    동 기 화 한 경 우   1로 설정. ( 1 ) |

| 5       | 앞 문이 개 방 된 경 우   1로   설정. FRONT DOOR   OPENED.   |
|---------|-------------------------------------------------------------|
| 6       | 뒷 문이 개 방 된 경 우   1로 설정. RE A R DOOR OPENED.      |
| 7       | 팬 이 작 동 된 경 우   1로 설정. F A N OPER A TED.          |
| 8       | 히 터가 작 동 된 경 우   1로 설정. H A E TER OPER A TED.    |
| 9       | 제어기 스스로 리 셋 한 경 우   1로 설정. CONTROLLER RESET.  |
| 10 15 - | Re e ved. s r                                               |

## 명령어 코드 별 패킷 구성 4.4

## 4.4.1 A th u en ti ca ti on

## ▣ CSN(Con 요청(0 FF) 메시지 tr olle   S a r t ti on Num e ) b r x

접속된 제어기에 대해 수집서버에서 요청하는 첫 메시지로 제어기의 식 별을 위한 CSN을 요청 TCP , 하는 메시지이다.

| 항 목                           | 타입   |   길이 | 값           | 비고   |
|---------------------------------|--------|--------|--------------|--------|
| SENDER IP                       | C      |     16 |              |        |
| DESTIN A TION IP                | C      |     16 |              |        |
| CONTROLLER  K IND               | C      |      2 | VD           |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 | 0 FFFFFFFF x |        |
| TOT A L  LEN G H T              | N      |      4 | 9            |        |
| OPCODE                          | N      |      1 | 0 FF x       |        |
| T an ac r s ti on Num e b r     | B      |      8 |              |        |

## ▣ CSN(Con 응답(0 FF) 메시지 tr olle   S a r t ti on Num e ) b r x

제어기에 설정되어 있는 CSN 값 을 패킷에 담 아 서 수집서버로 전송한다.

| 항 목                           | 타입   |   길이 | 비고                            |
|---------------------------------|--------|--------|---------------------------------|
| SENDER IP                       | C      |     16 |                                 |
| DESTIN A TION IP                | C      |     16 |                                 |
| CONTROLLER  K IND               | C      |      2 |                                 |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |                                 |
| TOT A L  LEN G H T              | N      |      4 |                                 |
| OPCODE                          | N      |      1 |                                 |
| T an ac r s ti on Num e b r     | B      |      8 |                                 |
| Re ul  Code s t                 | N      |      1 |                                 |
| Con tr olle   S a u r t t s     | B      |      2 |                                 |
| 제어기 번호 (CSN)               | N      |      4 | 제어기에  저 장된  번호 를 설정 |

## 제어기 동 기 화 (Con 4.4.2 tr olle  Sync r hr on iz a ti on)

수집서버에서 매 폴링 사이 클 시점에서 전체 제어기에 동 화 기 명령을 전송하며 이 명 령을 수신한 제어기는 수집된 데이터를 계산하고 필요 교통량을 산 출 하여 수집서버로 전송 할 저 장 버퍼에 그 내용을 저 장하  된다 이와 게 동 시에 수집 버퍼의 내용을 비 우게 . 되고 데이터 수집을 재개한다.

## ▣ 제어기 동 화 기  요청(0 01) 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 10     |        |
| OPCODE                          | N      |      1 | 0 01 x |        |
| T an ac r s ti on Num e b r     | B      |      8 |        |        |
| FR AM E  NO                     | N      |      1 |        |        |

- ① 현 재 시간 프레 임 번호 FR AM E NO( )
-  시간에 대한 폴링 사이 클 을 계산하여 다음과 같이 설정된다. 1
-  초 폴링 사이 클: 범 위의 정수 값 설정. 30 1 ~ 120
- ▣ 제어기 동 화 기  응답(0 01) 메시지 x

응답메시지는 필요 없 음.

## 교통 데이터 수집 (T a 4.4.3 r ffi c Da a) t

수집서버가 제어기에 게 동 기  명령을 보 화 낸 직 후 교통 데이터를 요구하고 제어기는 이 명령에 따라 교통량,  점유율 차량 길이 및 속도 데이터를 계산하여 현 재 FR , AM E 와 함께 응답하 게 된다. 현 재 FR 는 이전의 동 화 기  명령에서 보 N UMB ER AM E N UMB ER 낸 FR 이지만 동 화 기 되지 않은 제어기의 경 우 에는 자체에서 누 적한 AM E N UMB ER AU TO 의 FR 가 된다. RES Y NC H RONI ZA TION AM E N UMB ER

▣ 교통 데이터 수집 (0 04) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 9      |        |
| OPCODE                          | N      |      1 | 0 04 x |        |
| T an ac r s ti on Num e b r     | B      |      8 |        |        |

## ▣ 교통 데이터 수집 (0 04) 응답 메시지 x

| 항 목                           | 타입   | 길이   | 값        | 비고                   |
|---------------------------------|--------|--------|-----------|------------------------|
| SENDER IP                       | C      | 16     |           |                        |
| DESTIN A TION IP                | C      | 16     |           |                        |
| CONTROLLER  K IND               | C      | 2      | VD        |                        |
| CONTROLLER  ST A TION  N UMB ER | N      | 4      |           |                        |
| TOT A L  LEN G H T              | N      | 4      | [ N ]+ 13 |                        |
| OPCODE                          | N      | 1      | 0 04 x    |                        |
| T an ac r s ti on Num e b r     | B      | 8      |           |                        |
| Re ul  Code s t                 | N      | 1      |           | 명령 처리 결과 코드    |
| Con tr olle   S a u r t t s     | B      | 2      |           | 장비 상태코드 값       |
| FR AM E  NO                     | N      | 1      |           | 현 재 시간 프레 임번호 |
| DETECTOR INFO                   | B      | [ N ]  |           |                        |

## ① DETECTOR INFO

-  검지기의 루프 별 및 차로 별 감 지 정보로 다음과 같이 구성된다.

| 항 목           | 타입   |   길이 | 값   | 비고                             |
|-----------------|--------|--------|------|----------------------------------|
| 루프 장 애 정보 | B      |      8 |      | 당   2 총 개Loop) Loop bits ( 32 |

| 루프 유고정보                      | 루프 유고정보      | B   | 4   |       | 당   1 총   32개Loop) Loop bit (      |
|------------------------------------|--------------------|-----|-----|-------|---------------------------------------|
| 루프 개수                          | 루프 개수          | N   | 1   | [ n ] | 루프 개수 정보(0  ~   32)             |
| 감 지기  정보 루프  ( 수만 큼 )    | 루프1 교통량       | N   | 1   |       | 정수  값 (0  ~   255)                 |
| 감 지기  정보 루프  ( 수만 큼 )    | 루프1 점유율       | N   | 2   |       | 소수  자리 실수  값 2 (0.00 ~ 100.00) |
| 감 지기  정보 루프  ( 수만 큼 )    | ……                 | ……  | ……  | ……    | ……                                    |
| 감 지기  정보 루프  ( 수만 큼 )    | 루프n 교통량       | N   | 1   |       | 정수  값 (0  ~   255)                 |
| 감 지기  정보 루프  ( 수만 큼 )    | 루프n 점유율       | N   | 2   |       | 소수  자리 실수  값 2 (0.00 ~ 100.00) |
| 차 선   수                         | 차 선   수         | N   | 1   | [ m ] | 정수  값 (0  ~   16)                  |
| 차 선   별  정보 차 선 ( 수만 큼 ) | 차 선 평균속도 1   | N   | 1   |       | 차 선 평균속도 1                      |
| 차 선   별  정보 차 선 ( 수만 큼 ) | 차 선 차량길이 1   | N   | 1   |       | 차 선 평균차량길이 1                  |
| 차 선   별  정보 차 선 ( 수만 큼 ) | ……                 | ……  | ……  | ……    | ……                                    |
| 차 선   별  정보 차 선 ( 수만 큼 ) | 차 선 평균속 m  도 | N   | 1   |       | 차 선 평균속도 m                      |
| 차 선   별  정보 차 선 ( 수만 큼 ) | 차 선 차량길 m  이 | N   | 1   |       | 차 선 평균차량길이 m                  |

- ( ) i 감 지기 장 애 정보
-  바 이트 0 부터 2 비트  루프 하나의 장 씩 애 정보가 저 장되도록 한다. 1 st bit
-  최대 32개의 루프정보를 담기 위해 8 바 이트 길이를 가진다.
-  비트 에러코드 정의 2

루프 데이터는 기본적으로 쌍 루프 데이터를 송수신 한다 차 선 수는 전체 루프 갯 수를  로 나 # . 2 눈 값 과 일치해야 한다. 따라 서 검지기는 단 루프 일지 라 도 데이터를 복 사하여 쌍 루프 프로토 콜에 맞게 서버로 송신한다.

| NO            | 에러코드명            | 값 비고                     | 값 비고                                                                                          | 값 비고                                |
|---------------|-----------------------|-----------------------------|--------------------------------------------------------------------------------------------------|----------------------------------------|
| 1 NOR         | MA L 00               | b 감                        | 지기 상태 정상                                                                                   | 지기 상태 정상                         |
| 2 ST U K      | C  ON                 | 01  b                       | 감 지기의  ON 상태가  전체  감 지시간      중  차지하는  ' ' 비율이  임 계치 이상일  때   설정.  |                                        |
| 3 ST          | U K C  OFF            | 10  b                       | 감 지기의  OFF 상태가  전체  감 지시간      중  차지하는  ' ' 비율이  임 계치 이상일  때   설정. |                                        |
| 4 OSCILL      | A TION                | 11  b                       | 폴링주 기 당   해 당 감 지기를 통과하는 차량이  임 상일  때   설정.                              | 계치 이                                |
| 값 을  표현 * | 함에 있어 이진수      | 임 을 나                    | 타 내기 위해  기 호 를 사용함( b bit )                                                           | 타 내기 위해  기 호 를 사용함( b bit ) |
|              | 선언 ST U K C  ON/OFF | 을 위한                     | 임 계치기본 ) 값 (                                                                               | 임 계치기본 ) 값 (                     |
| 구분          | " "                   | 최대  ON 상태 비율  및 시간 | 최대  OFF  상태 비율  ' " 및 시간 모니                                                           | 터 링   시간                           |

| High   Volume   | 분) 9 5 % (114   | 분) 60 % (72   | 분 120   |
|-----------------|------------------|----------------|----------|
| Lo w   Volume   | 분) 65 % (156    | 분) 9 8 % (235 | 분 240   |

## ( ii ) 감 지기 유고정보

-  바 이트 0 부터 1 비트  루프 하나의 유고정보가 씩 저 장되도록 한다. 1 st bit
-  최대 32개의 루프정보를 담기 위해 4 바 이트 길이를 가진다.
-  비트 에러코드 정의 1

|   NO | 유고정보          |   값 | 비고         |
|------|-------------------|------|--------------|
|    1 | NOR MA L          |    0 | 유고  없 음. |
|    2 | INCIDENT DETECTED |    1 | 유고  감 지. |

## ( iii ) 루프 교통량

-  범 위의 정수 값 으로 설정  은 교통량이 없 을 경 우 를 의 미 한다. 0 ~ 255 0

## ( v) i 루프 점유율

-  범 위의 소수점  자리 실수 값 으로 설정. 0 ~ 100 2
-  바 이트 중 상위 1 바 이트에 정부부분을 하위 1 바 이트에 소수부분(0 을 넣 는다. 2 ~99 )

## (v) 평균속도

-  범 위의 정수 값 으로 설정. 0 ~ 255
-  평균속도는 소수점 이하 올림 처리하여 정수 값 을 사용한다.
-  도로가 정체되어 차량이 전 혀 움직 이지 않을 경 우 검지기 정보 중  평균속도 와  교통량 , ' ' ' ' 정보는  으로 설정되고 점유율이 100 로 설정된다 도로상에 차량이 없 는 경 우 점유율은 0 , % . 가 된다. 0 %

## 속도 데이터 수집 (Speed Da a) 4.4.4 t

특 정 차 선 에 대한 속도 C TE OR 별 교통량을 수집하기 위한 것으로 서버로부터의 A G Y 요구 시 마 다 초기 화 되고 초기 화 이후 계속 누 적된다. ,

## ▣ 속도 데이터 수집 (0 05) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고                |
|---------------------------------|--------|--------|--------|---------------------|
| SENDER IP                       | C      |     16 |        |                     |
| DESTIN A TION IP                | C      |     16 |        |                     |
| CONTROLLER  K IND               | C      |      2 | VD     |                     |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |                     |
| TOT A L  LEN G H T              | N      |      4 | 10     |                     |
| OPCODE                          | N      |      1 | 0 05 x |                     |
| T an ac r s ti on Num e b r     | B      |      8 |        |                     |
| L A NE NO                       | N      |      1 |        | 차 선 번호 - (1 16) |

## ① L A NE NO

 차 ) 선 Speed Loop Pa ir Lo gi cal  Po siti on (1 ~ 16

## ▣ 속도 데이터 수집 (0 05) 응답 메시지 x

| 항 목                           | 타입   |   길이 | 비고                  |
|---------------------------------|--------|--------|-----------------------|
| SENDER IP                       | C      |     16 |                       |
| DESTIN A TION IP                | C      |     16 |                       |
| CONTROLLER  K IND               | C      |      2 |                       |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |                       |
| TOT A L  LEN G H T              | N      |      4 |                       |
| OPCODE                          | N      |      1 |                       |
| T an ac r s ti on Num e b r     | B      |      8 |                       |
| Re ul  Code s t                 | N      |      1 | 명령 처리 결과 코드   |
| Con tr olle   S a u r t t s     | B      |      2 | 장비 상태코드 값      |
| L A NE NO                       | N      |      1 | 요청  받 은 차 선번호 |
| SPEED D A A T                   | B      |     24 | 차 선   속도 데이터   |

## ① SPEED D TE A

-  16 -bit modula  coun  a r t ft e  con r tr olle r r e e  o  a s t r ft e r th e la st ac q isiti u on b y s e ve . r r

| 항 목                             | 타입   | 길이   | 비고                           |
|-----------------------------------|--------|--------|--------------------------------|
| Speed Ca e t g o y  1  Coun r ts  | N      | 2      | M B f S ollo w ed  b y  LS B . |
| Speed Ca e t g o y  2  Coun r ts  | N      | 2      | M B f S ollo w ed  b y  LS B . |
| ……                                | ……     | ……     | ……                             |
| Speed Ca e t g o y  12  Coun r ts | N      | 2      | M B f S ollo w ed  b y  LS B . |

## 차량길이 데이터 수집 (Ve 4.4.5 hi cle Len gth Da a) t

특 정 차 선 에 대한 차량길이 C TE OR 별 교통량을 수집하기 위한 것으로 서버로부터 A G Y 의 요구 시 마 다 초기 화 되고 초기 화 후 계속 누 적된다. ,

## ▣ 차량길이 데이터 수집 (0 06) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고                |
|---------------------------------|--------|--------|--------|---------------------|
| SENDER IP                       | C      |     16 |        |                     |
| DESTIN A TION IP                | C      |     16 |        |                     |
| CONTROLLER  K IND               | C      |      2 | VD     |                     |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |                     |
| TOT A L  LEN G H T              | N      |      4 | 10     |                     |
| OPCODE                          | N      |      1 | 0 06 x |                     |
| T an ac r s ti on Num e b r     | B      |      8 |        |                     |
| L A NE NO                       | N      |      1 |        | 차 선 번호 - (1 16) |

## ① L A NE NO

-  차 선 Speed Loop Pa ir Lo gi cal  Po siti on (1 ~ 16)

## ▣ 차량길이 데이터 수집 (0 06) 응답 메시지 x

| 항 목                           | 타입   |   길이 | 비고                    |
|---------------------------------|--------|--------|-------------------------|
| SENDER IP                       | C      |     16 |                         |
| DESTIN A TION IP                | C      |     16 |                         |
| CONTROLLER  K IND               | C      |      2 |                         |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |                         |
| TOT A L  LEN G H T              | N      |      4 |                         |
| OPCODE                          | N      |      1 |                         |
| T an ac r s ti on Num e b r     | B      |      8 |                         |
| Re ul  Code s t                 | N      |      1 | 명령 처리 결과 코드     |
| Con tr olle   S a u r t t s     | B      |      2 | 장비 상태 코드  값      |
| L A NE NO                       | N      |      1 | 요청  받 은 차 선번호   |
| LEN G H T   D A A T             | B      |      6 | 차 선   차량길이 데이터 |

## ① LEN G H T D A A T

-  16 -bit modula  coun  a r t ft e  con r tr olle r r e e  o  a s t r ft e r th e la st ac q isiti u on b y s e ve r r

| 항 목                                | 타입   |   길이 | 비고    | 비고                   |
|--------------------------------------|--------|--------|---------|------------------------|
| Ca e t g o y  1(S r MA LL)  Coun ts  | N      |      2 | M B f S | ollo w ed  b y  LS B . |
| Ca e t g o y  2( r M IDDLE) Coun ts  | N      |      2 | M B f S | ollo w ed  b y  LS B . |
| Ca e t g o y  12( r B G I )  Coun ts | N      |      2 | M B f S | ollo w ed  b y  LS B . |

## 누 적 교통량 데이터 수집 4.4.6

단 위 LOOP별 누 적 교통량을 수집하기 위한 것으로 서버로부터의 요구 시 마 다 초기 화 되고 초기 화 이후 계속 누 적된다. ,

## ▣ 누 적 교통량 데이터 수집 (0 07) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 9      |        |
| OPCODE                          | N      |      1 | 0 07 x |        |
| T an ac r s ti on Num e b r     | B      |      8 |        |        |

## ▣ 누 적 교통량 데이터 수집 (0 07) 응답 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고           | 비고                |
|---------------------------------|--------|--------|--------|----------------|---------------------|
| SENDER IP                       | C      |     16 |        |                |                     |
| DESTIN A TION IP                | C      |     16 |        |                |                     |
| CONTROLLER  K IND               | C      |      2 | VD     |                |                     |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |                |                     |
| TOT A L  LEN G H T              | N      |      4 | 76     |                |                     |
| OPCODE                          | N      |      1 | 0 07 x |                |                     |
| T an ac r s ti on Num e b r     | B      |      8 |        |                |                     |
| Re ul  Code s t                 | N      |      1 |        |                | 명령 처리 결과 코드 |
| Con tr olle   S a u r t t s     | B      |      2 |        | 장비 상태 코드 | 값                  |
| VOL UM E  D A A T               | B      |     64 |        | 누             | 적 교통량 데이터    |

## ① VOL UM E D T A A

-  최대 32개의 루프 별 누 적 교통량 정보루프 당 바 2 이트) (
-  16 -bit modula  coun  a r t ft e  con r tr olle r r e e  o  a s t r ft e r th e la st ac q isiti u on b y s e ve . r r

| 항 목         | 타입   | 길이   | 비고   |
|---------------|--------|--------|--------|
| LOOP1 Volume  | N      | 2      |        |
| LOOP2 Volume  | N      | 2      |        |
| ……            | ……     | ……     | ……     |
| Loop32 Volume | N      | 2      |        |

## 교통상태 임 계치 지정 (Selec  De ec o  E 4.4.7 t t t r rr o  T r hr e sh old)

감 지기 장 애 t 판단 을 위한 교통상태 임 계치를 지정한다. (S uc k On/O ff ,  O s c lla i ti on)

## ▣ 교통상태 임 계치 지정 (0 08) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고    |
|---------------------------------|--------|--------|--------|---------|
| SENDER IP                       | C      |     16 |        |         |
| DESTIN A TION IP                | C      |     16 |        |         |
| CONTROLLER  K IND               | C      |      2 | VD     |         |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |         |
| TOT A L  LEN G H T              | N      |      4 | 10     |         |
| OPCODE                          | N      |      1 | 0 08 x |         |
| T an ac r s ti on Num e b r     | B      |      8 |        |         |
| T H RES H OLD                   | N      |      1 |        | 임 계치 |

## ① T H RES H OLD

## 임 계치 코드

## 의 미

|   0 | Lo w   Volume T a r ffi c  T hr e sh old   |
|-----|--------------------------------------------|
|   1 | High   Volume T a r ffi c  T hr e sh old   |

## ▣ 교통상태 임 계치 지정 (0 08) 응답 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고                | 비고    | 비고   |
|---------------------------------|--------|--------|--------|---------------------|---------|--------|
| SENDER IP                       | C      |     16 |        |                     |         |        |
| DESTIN A TION IP                | C      |     16 |        |                     |         |        |
| CONTROLLER  K IND               | C      |      2 | VD     |                     |         |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |                     |         |        |
| TOT A L  LEN G H T              | N      |      4 | 13     |                     |         |        |
| OPCODE                          | N      |      1 | 0 08 x |                     |         |        |
| T an ac r s ti on Num e b r     | B      |      8 |        |                     |         |        |
| Re ul  Code s t                 | N      |      1 |        | 명령 처리 결과 코드 |         |        |
| Con tr olle   S a u r t t s     | B      |      2 |        | 장비 상태 코드      |         | 값     |
| T H RES H OLD                   | N      |      1 |        | 지정된  임          | 계치 값 |        |

## 제어기  / 상태정보 수집 (Con olle  Val da 4.4.8 H W tr r i ti on)

제어기의  / 상태 정보에러상태를 검사한다. H W ( )

## ▣ 제어기의 상태정보 수집 (0 0 ) 요청 메시지 H W / x B

| 항 목                           | 타입   |   길이 | 값      | 비고   |
|---------------------------------|--------|--------|---------|--------|
| SENDER IP                       | C      |     16 |         |        |
| DESTIN A TION IP                | C      |     16 |         |        |
| CONTROLLER  K IND               | C      |      2 | VD      |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |         |        |
| TOT A L  LEN G H T              | N      |      4 | 9       |        |
| OPCODE                          | N      |      1 | 0 0 x B |        |
| T an ac r s ti on Num e b r     | B      |      8 |         |        |

## ▣ 제어기의 상태정보 수집 (0 0 ) 응답 메시지 H W / x B

| 항 목                           | 항 목                           | 타입   |   길이 | 비고                       |
|---------------------------------|---------------------------------|--------|--------|----------------------------|
| SENDER IP                       | SENDER IP                       | C      |     16 |                            |
| DESTIN A TION IP                | DESTIN A TION IP                | C      |     16 |                            |
| CONTROLLER  K IND               | CONTROLLER  K IND               | C      |      2 |                            |
| CONTROLLER  ST A TION  N UMB ER | CONTROLLER  ST A TION  N UMB ER | N      |      4 |                            |
| TOT A L  LEN G H T              | TOT A L  LEN G H T              | N      |      4 |                            |
| OPCODE                          | OPCODE                          | N      |      1 |                            |
| T an ac r s ti on Num e b r     | T an ac r s ti on Num e b r     | B      |      8 |                            |
| Re ul  Code s t                 | Re ul  Code s t                 | N      |      1 | 명령 처리 결과 코드        |
| Con tr olle   S a u r t t s     | Con tr olle   S a u r t t s     | B      |      2 | 장비 상태 코드  값         |
| Po w r e   Supply               | 장치 개수                       | N      |      1 | 정수) 0  ~   8  (          |
| Po w r e   Supply               | 상태 정보                       | B      |      1 | 개까지  표현 M x a .  8 .  |
| 검지기  보드 상태               | 보드 개수                       | N      |      1 | 정수) 0  ~   16  (         |
| 검지기  보드 상태               | 상태 정보                       | B      |      2 | 개까지  표현 M x a .  16 . |

- ① Po w r e  Supply
-  제어기에 부 착 되어 있는 전 원 장치에 대한 상태정보를 표현 하기 위한 필드이다.
-  그 개수정보만 큼 상태코드를 비트별로 나 타낸 다.
- ( ) i 장치 개수
-  제어기에 설치되어 있는 Po e  Supply의 개수를 의 미 한다. w r
-  이상의 정수 값 을 사용한다. 0
- ( ii ) 상태 정보
-  각각의 Po e  Supply 상태정보를 비트별로 할당 하여 정보를 표현 한다. w r
-  개수만  0 큼 번 비트부터 할당 하여 상태를 표 시한다. Po w r e  Supply
-  상태정보는 정상인 경 우 를 0으로 하고 그 렇 지 않은 경 우 를  로 한다. , 1

- ② 검지기 보드 상태
-  제어기에 부 착 되어 있는 검지기 보드에 대한 상태정보를 표현 하기 위한 필드이다.
-  그 개수정보만 큼 상태정보를 비트별로 나 타낸 다.
- ( ) i 보드 개수
-  제어기에 설치되어 있는 검지기 보드의 개수를 나 타낸 다.
-  이상의 정수 값 을 사용한다. 0
- ( ii ) 상태 정보
-  각각의 검지기 보드 상태 정보를 비트별로 할당 하여 표현 한다.
-  보드 개수만 큼 번 0 비트부터 할당 하여 상태를 표 시한다.
-  상태정보는 정상인 경 우 를 0으로 하고 그 렇 지 않은 경 우 를  로 한다. , 1

## 제어기 리 셋 (Re e  Con 4.4. 9 s t tr olle ) r

제어기에 대한 S/ 리 셋 을 요청하는 메시지. W

## ▣ 제어기 리 셋 (0 0C) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 9      |        |
| OPCODE                          | N      |      1 | 0 0C x |        |
| T an ac r s ti on Num e b r     | B      |      8 |        |        |

## ▣ 제어기 리 셋 (0 0C) 응답 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고           | 비고                |
|---------------------------------|--------|--------|--------|----------------|---------------------|
| SENDER IP                       | C      |     16 |        |                |                     |
| DESTIN A TION IP                | C      |     16 |        |                |                     |
| CONTROLLER  K IND               | C      |      2 | VD     |                |                     |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |                |                     |
| TOT A L  LEN G H T              | N      |      4 | 12     |                |                     |
| OPCODE                          | N      |      1 | 0 0C x |                |                     |
| T an ac r s ti on Num e b r     | B      |      8 |        |                |                     |
| Re ul  Code s t                 | N      |      1 |        |                | 명령 처리 결과 코드 |
| Con tr olle   S a u r t t s     | B      |      2 |        | 장비 상태 코드 | 값                  |

- ( ) i 제어기에서 정상적인 처리가 되지 않을 경 우 Re ul  Code에 그에 상응하는 코드를 설정한 s t 다.

## 제어기 초기 화 (In 4.4.10 iti al iz e Con tr olle ) r

제어기에 대한 초기 를 요청하는 메시지. 화 H W /

## ▣ 제어기 초기 화 (0 0D) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 9      |        |
| OPCODE                          | N      |      1 | 0 0D x |        |
| T an ac r s ti on Num e b r     | B      |      8 |        |        |

## ▣ 제어기 초기 화 (0 0D) 응답 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고           | 비고                |
|---------------------------------|--------|--------|--------|----------------|---------------------|
| SENDER IP                       | C      |     16 |        |                |                     |
| DESTIN A TION IP                | C      |     16 |        |                |                     |
| CONTROLLER  K IND               | C      |      2 | VD     |                |                     |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |                |                     |
| TOT A L  LEN G H T              | N      |      4 | 12     |                |                     |
| OPCODE                          | N      |      1 | 0 0D x |                |                     |
| T an ac r s ti on Num e b r     | B      |      8 |        |                |                     |
| Re ul  Code s t                 | N      |      1 |        |                | 명령 처리 결과 코드 |
| Con tr olle   S a u r t t s     | B      |      2 |        | 장비 상태 코드 | 값                  |

- ( ) i 제어기에서 정상적인 처리가 되지 않을 경 우 Re ul  Code에 그에 상응하는 코드를 설정한 s t 다.

## 파라미 터 다 운 로드 (Do 4.4.11 w nload Pa ame e ) r t r

제어기의 정상 동 작을 위해 필요한 각종 파라미 터 값 을 서버에서 제어기로 송신한다. 다 로드가 안된 상태에서는 제어기 자체의 기본 운 값 을 이용한다.

과 달리 TCP 검지기는 초기 설치 시 파라미 터들(LOOP 개수 및 차 선 정보 등 을 de aul  로 # Se ri al ...) f t 가지고 동 작해야 한다 즉 서버에서 초기 통신 연결 시 파라미 터들을 자 동 으로 다 운 로드 하지 않는 . 다.

## ▣ 파라미 터 다 운 로드 (0 0E) 요청 메시지 x

| 항 목                           | 타입   | 길이   | 값        |
|---------------------------------|--------|--------|-----------|
| SENDER IP                       | C      | 16     |           |
| DESTIN A TION IP                | C      | 16     |           |
| CONTROLLER  K IND               | C      | 2      | VD        |
| CONTROLLER  ST A TION  N UMB ER | N      | 4      |           |
| TOT A L  LEN G H T              | N      | 4      | 10 +[ N ] |
| OPCODE                          | N      | 1      | 0 0E x    |
| T an ac r s ti on Num e b r     | B      | 8      |           |
| 파라미 터 인 덱 스              | N      | 1      |           |
| 파라미 터                       | B      | [ N ]  |           |

## ① 파라미 터 인 덱 스

-  Pa ame e  Iden r t r tifi e  (1 r ~ 24).

| Pa ame e r t r                                              | Pa ame e r t r                       | Inde   x Code   | 비고                       |
|-------------------------------------------------------------|--------------------------------------|-----------------|----------------------------|
| Loop De ec o    Con t t r                                   | fig u a r ti on                      | 1 루프          | 감 지기 지정               |
| Speed Loop   Con                                            | fig u a r ti on                      | 2 속도          | 감 지 루프 지정            |
| Poll n i g   Cycle                                          | Poll n i g   Cycle                   | 3               | 수집  주 기                |
| Ve hi cle      De                                           | fi n iti on                          | 4 차량          | 감 응시간 정의             |
| Speed   Ca e t g o ri e s                                   | Speed   Ca e t g o ri e s            | 5               | 차량 속도 구분             |
| Ve hi cle  Len gth                                          | Ca t e g o ri e s                    | 6               | 차량 길이 구분             |
| Speed Ca e t g o y      r A                                 | ccumula ti on D is a b le/Ena b le 7 |                 | 속도 별  누 적 치 계산     |
| Ve hi cle  Len gth A                                        | ccumula ti on D is a b le/Ena b le 8 |                 | 차량길이 별  누 적 치 계산 |
| Speed   Calcula ti on D is a b                              | le/Ena b le 9                        |                 | 속도 계산 가능 여부        |
| Ve hi cle  Len gth       Calcula ti on D is a b le/Ena b le | 10                                   |                 | 차량길이 계산 가능 여부    |
| Speed Loop   D men s                                        | i si on                              | 11              | 속도 Loop 간격 및 길이     |
| U ppe  Volume   L m r                                       | i it                                 | 12              | 교통량 상한치              |
| U ppe  Speed   L m r                                        | i it                                 | 13              | 차량 속도 상한치           |

| U ppe  Ve r hi cle      Len gth   L m i it                   | 14   | 차량길이 상한치               |
|--------------------------------------------------------------|------|-------------------------------|
| Inc den       De ec i t t ti on T hr e sh old                | 15   | 유고정의를 위한  임 계치      |
| Loop De ec o    S uc  ON / OFF t t r t k                     | 16   | 임 계치 S uc t k       ON/OFF |
| Loop De ec o    O c lla t t r s i ti on T hr e sh old        | 17   | 임 계치 O c lla s i ti on     |
| [ Re e ved s r ]                                             | 18   |                               |
| [ Re e ved s r ]                                             | 1 9  |                               |
| A t u o   Re Sync - hr on iz a ti on  W iti a n g   Pe ri od | 20   |                               |
| S mula i ti on   Templa e t s                                | 21   |                               |
| [ Re e ved s r ]                                             | 22   |                               |
| [ Re e ved s r ]                                             | 23   |                               |
| [ Re e ved s r ]                                             | 24   |                               |

## ② 파라미 터별 구성

|   ID X | BY TE   | 설명                                                                                                  | 비고                                                                                                 |
|--------|---------|-------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
|      1 | 1 4 -   | 감 지기  지정.(Loop 당       1비 LOOP  # ~# 1 32  트)                                                 |                                                                                                      |
|      2 | 1       | 차  하류 부 LOOP  선 감 지기  번호 1                                                                  | 속도  감 지가  불 가능한  감 지기  번호 는 0 FF. LOOP  x 단 루프 설정시에도 사용. 아래   비고)  참조 |
|      2 | 2       | 차  상류 부 LOOP  선 감 지기  번호 1                                                                  | 속도  감 지가  불 가능한  감 지기  번호 는 0 FF. LOOP  x 단 루프 설정시에도 사용. 아래   비고)  참조 |
|      2 | ……      | ……                                                                                                    | 속도  감 지가  불 가능한  감 지기  번호 는 0 FF. LOOP  x 단 루프 설정시에도 사용. 아래   비고)  참조 |
|      2 | 32      | 차 선   상류 부 LOOP  감 지기  번호 16                                                                | 속도  감 지가  불 가능한  감 지기  번호 는 0 FF. LOOP  x 단 루프 설정시에도 사용. 아래   비고)  참조 |
|      3 | 1       | 폴링 주 기초) (                                                                                       | 범 위 기본 30초 14 ~ 120  .  :                                                                       |
|      4 | 1       | N UMB ER  OF  CONSEC U TIVE  P U LSE  [ 10 M SEC ] W H IT   VE H ICLE  PRESENCE (DEF AU LT  =   6)    |                                                                                                      |
|      4 | 2       | N UMB ER  OF  CONSEC U TIVE  P U LSE  [ 10 M SEC ] W H IT   NO  VE H ICLE  PRESENCE  (DEF AU LT  = 3) |                                                                                                      |
|      5 | 1       | 차량속도  종( m/ ) 1 k h                                                                              | 기본 값:   0  ~   10      k m/ hr                                                                    |
|      5 | 2       | 차량속도  종( m/ ) 2 k h                                                                              | 기본 값:   11  ~       20  k m/ hr                                                                   |
|      5 | ……      | ……                                                                                                    | ……                                                                                                   |
|      5 | 11      | 차량속도 11종( m/ ) k h                                                                               | 기본 값:   101  ~   110  k m/ hr                                                                     |
|      5 | 12      | 차량속도 12종( m/ ) k h                                                                               | 기본 값: 이상   111  k m/ hr                                                                         |
|      6 | 1       | 차량길이  종 S 1 : MA LL                                                                              | 기본 값:   80  dm                                                                                    |
|      6 | 2       | 차량길이  종  I 2 : B G                                                                               | 기본 값:   150  dm                                                                                   |
|      6 | 3       | [ RESERVED ]                                                                                          |                                                                                                      |
|      7 | 1       | 속도 별  누 적 치 계산 가능 여부                                                                      | 불 가능, 1  가능기본 ) 값 0   : : (                                                                  |
|      8 | 1       | 차량길이 별  누 적 치 계산 가능 여부                                                                  |                                                                                                      |

|   9 | 1       | 속도계산 가능 여부                                                                                                       |                                                                        |
|-----|---------|--------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|  10 | 1       | 차량길이 계산 가능 여부                                                                                                  |                                                                        |
|  11 | 1 16 -  | 각  바 이트 당   속도 LOOP 각각의 간격정보.                                                                              | 45 dm(0 2D) x                                                          |
|  11 | 17 32 - | 각  바 이트   속도  LOOP  당 각각의  유효  길이 정보. LOOP                                                               | 18 dm(0 12) x                                                          |
|  12 | 1       | 주 기 당   교통량  임 계치 POLLIN G                                                                                      | 기본 값: 대   25                                                       |
|  13 | 1       | 주 기 당   속도  임 계치 POLLIN G                                                                                        | 기본 값:   175      k m/ h                                             |
|  14 | 1       | 주 기 당   차량길이  임 계치 POLLIN G                                                                                    | 기본 값:   250  dm                                                     |
|  15 | 1       | INCIDENT E X EC U TION C CLE Y                                                                                           | 기본 값: 초   5                                                        |
|  15 | 2       | PERSISTENCE PERIOD                                                                                                       | 기본 값: 초   2                                                        |
|  15 | 3       | 선택 A G L ORIT HM 코드 설명 1 점유율 데이터 이용 2 속도 데이터 이용 3 교통량 데이터 이용 4 점유율 및 교통량 데이터 이용 | 기본 값:   1                                                           |
|  15 | 4 5 -   | K f ac o   t r # 1                                                                                                       |                                                                        |
|  15 | 6 7 -   | K f ac o   t r # 2                                                                                                       |                                                                        |
|  15 | 8 71 -  | 별  임 계치정보 루프 당   2 바 이트 사용) LOOP .(                                                                        | 기본 값:   100 %                                                       |
|  16 | 1       | 교통량  과다상태의  지속시간(Du a on  r ti f o   r High   Volume T a r ffi c)                                            | 기본 값: 분)   120(                                                    |
|  16 | 2       | 교통량 과다상태의 ON 지속시간                                                                                            | 기본 값: 분)   114(                                                    |
|  16 | 3       | 교통량 과다상태의 OFF 지속시간                                                                                           | 기본 값: 분)   48(                                                     |
|  16 | 4       | 교통량  희 소상태의 지속시간                                                                                             | 기본 값: 분)   240(                                                    |
|  16 | 5       | 교통량  희 소상태의 ON 지속시간                                                                                          | 기본 값: 분)   156(                                                    |
|  16 | 6       | 교통량  희 소상태의 OFF 지속시간                                                                                         | 기본 값: 분)   1(                                                      |
|  17 | 1       | 임 계치  차량) OSCILL A TION  (                                                                                          | 수집 주 기별 기본 값 초  주 기 30대 (1)  20 : 초  주 기 50대 (2)  30 : |
|  20 | 1       | A t u o Re Sync - hr on iz a ti on  W iti a n g   Pe ri od                                                               | 현 재 1초.                                                             |
|  21 | 1       | Da a S t tr eam Num e b r                                                                                                | 기본 값:   1                                                           |

| 2      | 코드 설명 0 S mula i ti on OFF 1 S mula i ti on ON                             | 기본 값:   0                                  |
|--------|--------------------------------------------------------------------------------|-----------------------------------------------|
| 3      | 차량길이                                                                       | 기본 값:   30                                 |
| 4      | 속도                                                                           | 기본 값:   100                                |
| 5      | H A E D WAY                                                                    | 기본 값:   40                                 |
| 6      | LOOP SEPER A TION DIST A NCE                                                   | 기본 값:   45                                 |
| 7      | EFFECTIVE LOOP LEN G H T                                                       | 기본 값:   18                                 |
| 8 14 - | 바 이트 1 과  동 일함.  단 # ~# 7 ,  Da a  S t tr eam  값 이 다름. Num e   b r | 의  기 Da a  S t tr eam  Num e b r 본 값:   2 |

비고) 파라미 터 ID  2 번 의 경 우 해 당 차 선 의 루프가 단 루프 임 을 지정하기 위해 각 차 선 별 X 하류부 상류부 LOOP 감 지기 번호 중  하류 부 번호 만을 지정하여 다 운 로드 한다. /

## 또 한 검지기는 단 루프 일지 라 도 데이터를 복 사하여 쌍 루프 프로토콜에 맞게 서버로 송신한다.

예) 왕복 차 선 도로에 진 입 진 출 램 프( 단 루프가 각  차 선씩 있을 때 2 ) 1 .

차 선 하류부 LOOP 감 지기 번호 : 1 0

차 선 상류부 LOOP 감 지기 번호 : 1 1

차 선 하류부 LOOP 감 지기 번호 : 2 2

차 선 상류부 LOOP 감 지기 번호 : 2 3

차 선 하류부 LOOP 감 지기 번호 : 3 4

차 선 상류부 LOOP 감 지기 번호 : 3 5

차 선 하류부 LOOP 감 지기 번호 : 4 6

차 선 상류부 LOOP 감 지기 번호 : 4 7

차 선 하류부 LOOP 감 지기 번호 : 5 8

차 선 상류부 LOOP 감 지기 번호 : 5 255

차 선 하류부 LOOP 감 지기 번호 : 6 10

차 선 상류부 LOOP 감 지기 번호 : 6 255

## ▣ 파라미 터 다 운 로드 (0 0E) 응답 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고           | 비고                |
|---------------------------------|--------|--------|--------|----------------|---------------------|
| SENDER IP                       | C      |     16 |        |                |                     |
| DESTIN A TION IP                | C      |     16 |        |                |                     |
| CONTROLLER  K IND               | C      |      2 | VD     |                |                     |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |                |                     |
| TOT A L  LEN G H T              | N      |      4 | 12     |                |                     |
| OPCODE                          | N      |      1 | 0 0E x |                |                     |
| T an ac r s ti on Num e b r     | B      |      8 |        |                |                     |
| Re ul  Code s t                 | N      |      1 |        |                | 명령 처리 결과 코드 |
| Con tr olle   S a u r t t s     | B      |      2 |        | 장비 상태 코드 | 값                  |

##  유고 감 지 관련 파라미 터( 1, 및 기 타 임 계치에 의한 유고 감 지 알 고리 즘 K K 2, )

## 파라미 터 업 로드 ( 4.4.12 U pload Pa ame e ) r t r

현 재 제어기에 설정되어 있는 파라미 터 값 을 요청하는 메시지이다.

## ▣ 파라미 터 업 로드 (0 0F) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고      |
|---------------------------------|--------|--------|--------|-----------|
| SENDER IP                       | C      |     16 |        |           |
| DESTIN A TION IP                | C      |     16 |        |           |
| CONTROLLER  K IND               | C      |      2 | VD     |           |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |           |
| TOT A L  LEN G H T              | N      |      4 | 10     |           |
| OPCODE                          | N      |      1 | 0 0F x |           |
| T an ac r s ti on Num e b r     | B      |      8 |        |           |
| 파라미 터 인 덱 스              | N      |      1 |        | 1  ~   24 |

## ▣ 파라미 터 업 로드 (0 0F) 응답 메시지 x

| 항 목                           | 타입   | 길이   | 값        | 비고                    |
|---------------------------------|--------|--------|-----------|-------------------------|
| SENDER IP                       | C      | 16     |           |                         |
| DESTIN A TION IP                | C      | 16     |           |                         |
| CONTROLLER  K IND               | C      | 2      | VD        |                         |
| CONTROLLER  ST A TION  N UMB ER | N      | 4      |           |                         |
| TOT A L  LEN G H T              | N      | 4      | 13 +[ N ] |                         |
| OPCODE                          | N      | 1      | 0 0F x    |                         |
| T an ac r s ti on Num e b r     | B      | 8      |           |                         |
| Re ul  Code s t                 | N      | 1      |           | 명령 처리 결과 코드     |
| Con tr olle   S a u r t t s     | B      | 2      |           | 장비 상태 코드  값      |
| 파라미 터 인 덱 스              | N      | 1      |           | 요청  받았던   인 덱 스 |
| 파라미 터                       | B      | [ N ]  |           | 해 당 파라미 터 정보    |

## 제어기 온라 인 상태 (Onl ne S a u ) 4.4.13 i t t s

제어기에 대해 다음의 기능을 수 행 하기 위해 본 명령어 메시지를 사용한다.

-  제어기가 명령 요청에 정상 응답하는가
-  최  수집서버와의 통신이후 경과시간 근 취득
-  제어기로 전송된 요청명령에 대해 응답 타임아웃 이 발생 한 경 우 에 대해 해 당 장비 , 에 대한 타임아웃 상태를 정상 상태로 되 돌 리는 기능

## ▣ 제어기 온라 인 상태 확인 (0 11) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 9      |        |
| OPCODE                          | N      |      1 | 0 11 x |        |
| T an ac r s ti on Num e b r     | B      |      8 |        |        |

## ▣ 제어기 온라 인 상태 확인 (0 11) 응답 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고                 | 비고                 |
|---------------------------------|--------|--------|--------|----------------------|----------------------|
| SENDER IP                       | C      |     16 |        |                      |                      |
| DESTIN A TION IP                | C      |     16 |        |                      |                      |
| CONTROLLER  K IND               | C      |      2 | VD     |                      |                      |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |                      |                      |
| TOT A L  LEN G H T              | N      |      4 | 16     |                      |                      |
| OPCODE                          | N      |      1 | 0 11 x |                      |                      |
| T an ac r s ti on Num e b r     | B      |      8 |        |                      |                      |
| Re ul  Code s t                 | N      |      1 |        | 명령 처리 결과 코드  |                      |
| Con tr olle   S a u r t t s     | B      |      2 |        | 장비 상태 코드       | 값                   |
| Pa ss ed T me i                 | N      |      4 |        | 정수 ( 값단 : 위 초) | 정수 ( 값단 : 위 초) |

- ① 제어기와 통신서버간 연결 수립 이후 지나간 시간정보초). Pa ss ed T me i : (
-  최소 ( 0 ), 최대  ( 2 31 값 값 초) ) ^ = 2,147,483,648 (

## 제어기 메 모 리 상태 ( 4.4.14 M emo y S a u ) r t t s

제어기는 이 명령을 수신한 직 후 메 모 리 검사를 실시하여 정상 동 작하지 않은 경 우 에 러정보를 담 아 응답한다.

## ▣ 제어기 메 모 리 상태 확인 (0 12) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 9      |        |
| OPCODE                          | N      |      1 | 0 12 x |        |
| T an ac r s ti on Num e b r     | B      |      8 |        |        |

## ▣ 제어기 메 모 리 상태 확인 (0 12) 응답 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고           | 비고                |
|---------------------------------|--------|--------|--------|----------------|---------------------|
| SENDER IP                       | C      |     16 |        |                |                     |
| DESTIN A TION IP                | C      |     16 |        |                |                     |
| CONTROLLER  K IND               | C      |      2 | VD     |                |                     |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |                |                     |
| TOT A L  LEN G H T              | N      |      4 | 12     |                |                     |
| OPCODE                          | N      |      1 | 0 12 x |                |                     |
| T an ac r s ti on Num e b r     | B      |      8 |        |                |                     |
| Re ul  Code s t                 | N      |      1 |        |                | 명령 처리 결과 코드 |
| Con tr olle   S a u r t t s     | B      |      2 |        | 장비 상태 코드 | 값                  |

- ( ) i 제어기에서 정상적인 처리가 되지 않을 경 우 Re ul  Code에 그에 상응하는 코드를 설정한 s t 다.

## 메시지 에코 확인 (Ec o 4.4.15 h M ss g e a e)

제어기의 문자 열 처리 기능을 검사하기 위한 것으로 통신 서버로부터 수신한 임 의의 문자 열 을 받 은 그대로 송신 할 수 있는지 검사한다.

## ▣ 메시지 에코 확인 (0 13) 요청 메시지 x

| 항 목                           | 타입   | 길이   | 값      | 비고            |
|---------------------------------|--------|--------|---------|-----------------|
| SENDER IP                       | C      | 16     |         |                 |
| DESTIN A TION IP                | C      | 16     |         |                 |
| CONTROLLER  K IND               | C      | 2      | VD      |                 |
| CONTROLLER  ST A TION  N UMB ER | N      | 4      |         |                 |
| TOT A L  LEN G H T              | N      | 4      | 9+[ N ] |                 |
| OPCODE                          | N      | 1      | 0 13 x  |                 |
| T an ac r s ti on Num e b r     | B      | 8      |         |                 |
| 에코 메시지                     | C      | [ N ]  |         | 문자  메시지 열 |

## ▣ 메시지 에코 확인 (0 13) 응답 메시지 x

| 항 목                           | 타입   | 길이   | 값        | 비고                 |
|---------------------------------|--------|--------|-----------|----------------------|
| SENDER IP                       | C      | 16     |           |                      |
| DESTIN A TION IP                | C      | 16     |           |                      |
| CONTROLLER  K IND               | C      | 2      | VD        |                      |
| CONTROLLER  ST A TION  N UMB ER | N      | 4      |           |                      |
| TOT A L  LEN G H T              | N      | 4      | 12 +[ N ] |                      |
| OPCODE                          | N      | 1      | 0 13 x    |                      |
| T an ac r s ti on Num e b r     | B      | 8      |           |                      |
| Re ul  Code s t                 | N      | 1      |           | 명령 처리 결과 코드  |
| Con tr olle   S a u r t t s     | B      | 2      |           | 장비 상태 코드  값   |
| 에코 메시지                     | C      | [ N ]  |           | 요청메시지의 문자 열 |

## 일련 번호 전송 (Send Se 4.4.16 q uence Num b r e )

제어기의 수치 처리기능을 검사하기 위한 것으로 통신서버로부터 수신한 임 의의 기 준 값 과 반 복 횟 수를 이용하여 기 준 값 으로부터 반 복횟 수만  1 큼 씩 누 적한 데이터를 계산하 여 응답한다.

## ▣ 일련 번호 전송 (0 14) 요청 메시지 x

| 항 목                           | 타입   | 길이   | 값     | 비고                          |
|---------------------------------|--------|--------|--------|-------------------------------|
| SENDER IP                       | C      | 16     |        |                               |
| DESTIN A TION IP                | C      | 16     |        |                               |
| CONTROLLER  K IND               | C      | 2      | VD     |                               |
| CONTROLLER  ST A TION  N UMB ER | N      | 4      |        |                               |
| TOT A L  LEN G H T              | N      | 4      | 11     |                               |
| OPCODE                          | N      | 1      | 0 14 x |                               |
| T an ac r s ti on Num e b r     | B      | 8      |        |                               |
| 기 준 값                        | N      | 1      |        | 일련 번호   기 준값 정수형) ( |
| 반 복 회 수                     | N      |        | 1      | 씩 누 적되는 반 복회 수 1     |

## ① 기 준값

-  바 이트 정수형으로 0 범 위의 숫 자로 설정한다. 1 ~ 127

## ② 반 복회 수

-  바 이트 정수형으로 0 범 위의 숫 자로 설정한다. 1 ~ 127

## ▣ 일련 번호 전송 (0 14) 응답 메시지 x

| 항 목                           | 타입   | 길이   | 값        | 비고                | 비고   |
|---------------------------------|--------|--------|-----------|---------------------|--------|
| SENDER IP                       | C      | 16     |           |                     |        |
| DESTIN A TION IP                | C      | 16     |           |                     |        |
| CONTROLLER  K IND               | C      | 2      | VD        |                     |        |
| CONTROLLER  ST A TION  N UMB ER | N      | 4      |           |                     |        |
| TOT A L  LEN G H T              | N      | 4      | 12 +[ N ] |                     |        |
| OPCODE                          | N      | 1      | 0 14 x    |                     |        |
| T an ac r s ti on Num e b r     | B      | 8      |           |                     |        |
| Re ul  Code s t                 | N      | 1      |           | 명령 처리 결과 코드 |        |
| Con tr olle   S a u r t t s     | B      | 2      |           | 장비 상태 코드      | 값     |
| 일련 번호   목록                | B      | [ N ]  |           |                     |        |

## ① 일련 번호 목록

-  요청 받았던 기 준 값 부터  반 복회 수 만 큼 씩 누 1 적된 값 들의 목록이며 각 값 은 1 바 이트 ' ' ' ' , 정수형이다. 또 한 그 값 의 범 위는 0 로 제한한다. ~ 254

## 버전정보 (Re ue 4.4.17 q st Ve rsi on)

제어기의 제작과 관련된 각종 정보를 요청하기 위한 메시지이다.

## ▣ 버전정보 (0 15) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 9      |        |
| OPCODE                          | N      |      1 | 0 15 x |        |
| T an ac r s ti on Num e b r     | B      |      8 |        |        |

## ▣ 버전정보 (0 15) 응답 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고           | 비고                |
|---------------------------------|--------|--------|--------|----------------|---------------------|
| SENDER IP                       | C      |     16 |        |                |                     |
| DESTIN A TION IP                | C      |     16 |        |                |                     |
| CONTROLLER  K IND               | C      |      2 | VD     |                |                     |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |                |                     |
| TOT A L  LEN G H T              | N      |      4 | 16     |                |                     |
| OPCODE                          | N      |      1 | 0 15 x |                |                     |
| T an ac r s ti on Num e b r     | B      |      8 |        |                |                     |
| Re ul  Code s t                 | N      |      1 |        |                | 명령 처리 결과 코드 |
| Con tr olle   S a u r t t s     | B      |      2 |        | 장비 상태 코드 | 값                  |
| 버전 정보                       | B      |      4 |        |                |                     |

## ① 버전 정보

 제어기의 버전 정보는 다음과 같이 구성된다.

|   BY TE | 설명                                           | 비고   |
|---------|------------------------------------------------|--------|
|       1 | Ve rsi on NO(4 bits )  +   Relea s e No(4 bits |        |
|       2 | 제 조 년 도   0  [ ~ 99 ]                      |        |
|       3 | 제 조 월 [   1  ~   12  ]                      |        |
|       4 | 제 조   일    1  [ ~   31  ]                   |        |

## 개별차량 데이터 (Ind v dual T a 4.4.18 i i r ffi c Da a) t

통신서버에서 제어기로 동 기  명령을 보 화 낸 직 후 개별차량 데이터 요청 명령을 통해 개 차량 데이터를 요구하고 제어기는 이 명령에 발 따라 개별차량에 대한 누 적데이터를 , 현 재 F ame 번호 와 함께 응답하 게 된다. 현 재 F ame 번호 는 이전의 동 화 기  명령에 ' r ' ' r ' 서 보 낸 r F ame 번호 이지만, 동 화 기 되지 않은 제어기의 경 우 에는 자체에서 누 적한  u o A t 의 F ame 번호 를 사용한다. Sync r

## ▣ 개별차량 데이터 (0 16) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 9      |        |
| OPCODE                          | N      |      1 | 0 16 x |        |
| T an ac r s ti on Num e b r     | B      |      8 |        |        |

## ▣ 개별차량 데이터 (0 16) 응답 메시지 x

| 항 목                           | 타입   | 길이     | 값           | 비고                |
|---------------------------------|--------|----------|--------------|---------------------|
| SENDER IP                       | C      | 16       |              |                     |
| DESTIN A TION IP                | C      | 16       |              |                     |
| CONTROLLER  K IND               | C      | 2        | VD           |                     |
| CONTROLLER  ST A TION  N UMB ER | N      | 4        |              |                     |
| TOT A L  LEN G H T              | N      | 4        | 15 +{ n }* 6 |                     |
| OPCODE                          | N      | 1        | 0 16 x       |                     |
| T an ac r s ti on Num e b r     | B      | 8        |              |                     |
| Re ul  Code s t                 | N      | 1        |              | 명령 처리 결과 코드 |
| Con tr olle   S a u r t t s     | B      | 2        |              | 장비 상태 코드  값  |
| T me F ame No. i r              | N      | 1        |              |                     |
| 전체 개별차량 수                | N      | 2        | { n }        | 대 { n }            |
| 개별차량 데이터                 | B      | { n }* 6 |              |                     |

- ① 현 재 시간에 대한 프레 임 번호 T me F ame No( i r )
-  시간에 대한 폴링주 기 시간으로 나 눈 번호 를 사용한다. 1
- ② 개별차량 데이터 아래 형 식 으로 된 데이터가  전체 개별차량 수만 큼 반 복 된다. : { }

 초 주 기인 경 우 : 30 1 ~ 120



초 주 기인 경 우 : 20 1 ~ 180

| 항 목                   | 타입   |   길이 | 비고                                             |
|-------------------------|--------|--------|--------------------------------------------------|
| 검지된 차로  번호       | N      |      1 |                                                  |
| 로부터 경과된 시간 Sync | N      |      1 | 기 준 은 이전  동 기 화   명령의 F ame  번호 r . |
| 차량 속도               | N      |      1 | k m/ h                                           |
| 점유시간                | N      |      2 | 초                                               |
| 차량길이 종류           | N      |      1 | 소형 / 2  중형 /   3  대형 1   : : :             |

## 정지 상 전송 (Ima e T an m 영 4.4.1 9 g r s issi on)

영 식 상  VDS인 경 우 현 재 영 상을 수집하기 위해 이 메시지를 이용한다.

## ▣ 정지 영 상 전송 (0 17) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 10     |        |
| OPCODE                          | N      |      1 | 0 17 x |        |
| T an ac r s ti on Num e b r     | B      |      8 |        |        |
| 카 메 라 식 별자                | N      |      1 |        |        |

## ① 카 메 라 식 별자

-  영 식 상  VDS인 경 우 에만 요청메시지에 대해 응답이 가능하다.
-  시점 방향 과 종점 방향 도로상에 각  대 씩 의 카 라 메 가 배 정되어 정지 영 상을 생 성하는데, 1 해 당 카 라 메 를 지정하기 위해 다음과 같은 코드를 할당 한다.

|   코드 | 설명                                                |
|--------|-----------------------------------------------------|
|      0 | 시점 방향 을  감 지하도록 설정된  카 메 라          |
|      1 | 종점 방향 을  감 지하도록 설정된  카 메 라          |
|      2 | 양방향 모두 감 지하도록 설정된    카 메 인 경 라 우 |

## ▣ 정지 영 상 전송 (0 17) 응답 메시지 x

| 항 목                           | 타입   | 길이   | 값          | 비고                |
|---------------------------------|--------|--------|-------------|---------------------|
| SENDER IP                       | C      | 16     |             |                     |
| DESTIN A TION IP                | C      | 16     |             |                     |
| CONTROLLER  K IND               | C      | 2      | VD          |                     |
| CONTROLLER  ST A TION  N UMB ER | N      | 4      |             |                     |
| TOT A L  LEN G H T              | N      | 4      | 17  + { n } |                     |
| OPCODE                          | N      | 1      | 0 17 x      |                     |
| T an ac r s ti on Num e b r     | B      | 8      |             |                     |
| Re ul  Code s t                 | N      | 1      |             | 명령 처리 결과 코드 |
| Con tr olle   S a u r t t s     | B      | 2      |             | 장비 상태 코드  값  |
| 지정된  카 메 라 식 별자        | N      | 1      |             |                     |
| 이 미 지 데이터 크기            | N      | 4      | { n }       |                     |
| 이 미 지 데이터                 | B      | { n }  |             |                     |

## 통신세션유효성 확인 (Se 4.4.20 ssi on Val da i ti on C h ec k )

장비가 서버측으로 세션상태가 정상인지 확인하기 위해 보내는 메시지. VDS 장비는 최종 요청메시지 수신후  분 동 안 아무런 메시지를 수신하지 못 하면 서버 VDS 5 , 낸 다.

및 재전송 규 칙 은 3. 통신흐름도에 준 한다.

- 에 통신세션유효성 확인 요청을 보 타임아웃

## ▣ 통신세션 유효성 확인 (0 18) 요청 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 10     |        |
| OPCODE                          | N      |      1 | 0 18 x |        |

## ▣ 통신세션 유효성 확인 (0 18) 응답 메시지 x

| 항 목                           | 타입   |   길이 | 값     | 비고   |
|---------------------------------|--------|--------|--------|--------|
| SENDER IP                       | C      |     16 |        |        |
| DESTIN A TION IP                | C      |     16 |        |        |
| CONTROLLER  K IND               | C      |      2 | VD     |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |        |        |
| TOT A L  LEN G H T              | N      |      4 | 10     |        |
| OPCODE                          | N      |      1 | 0 18 x |        |

## 돌발 검지 확인 4.4.21

장비가 서버측으로 돌발 정보를 보내는 메시지. VDS

## ▣ 확인 (0 1 ) 요청 메시지 x 9

| 항 목                           | 타입   | 길이   | 값         | 비고                                                              |
|---------------------------------|--------|--------|------------|-------------------------------------------------------------------|
| SENDER IP                       | C      | 16     |            |                                                                   |
| DESTIN A TION IP                | C      | 16     |            |                                                                   |
| CONTROLLER  K IND               | C      | 2      | VD         |                                                                   |
| CONTROLLER  ST A TION  N UMB ER | N      | 4      |            |                                                                   |
| TOT A L  LEN G H T              | N      | 4      | 10         |                                                                   |
| OPCODE                          | N      | 1      | 0 1 x 9    |                                                                   |
| INC T Y PE                      | N      | 1      | 돌발 타입  | 역주행 0 01    x : ,  정차차량,  0 02    x : 보 행 자 0 03    x : |
| DETECT DEVICE                   | N      | 1      | 검지  순번 | 장비  0 01   레이더 1 x : 레이더 2 0 02    x :                    |
| INC L A NE INFO                 | B      | [ N ]  |            | 돌발   검지 차로 정보                                             |
| 이 미 지 데이터 크기            | N      | 4      | { n }      |                                                                   |
| 이 미 지 데이터                 | B      | { n }  |            |                                                                   |

## ① INC L A NE INFO

 검지기의 루프 별 감 지 정보로 다음과 같이 구성된다.

| 항 목     | 항 목        | 타입   | 길이   | 값    | 비고             | 비고   | 비고    |
|-----------|--------------|--------|--------|-------|------------------|--------|---------|
| 차로 개수 |              | N      | 1      | [ n ] | 차로 개수 정보(0 |        | ~   32) |
| 돌발      | 차로  돌발 1 | N      | 1      |       | 정상, 1 0 : :    | 돌발   |         |
| 돌발      | 차로  돌발 2 | N      | 1      |       |                  |        |         |
| 돌발      | ……           | ……     | ……     | ……    | ……               | ……     | ……      |
| 돌발      | 차로  돌발 n | N      | 1      |       |                  |        |         |

## ▣ 확인 (0 1 ) 응답 메시지 x 9

| 항 목                           | 타입   |   길이 | 값      | 비고   |
|---------------------------------|--------|--------|---------|--------|
| SENDER IP                       | C      |     16 |         |        |
| DESTIN A TION IP                | C      |     16 |         |        |
| CONTROLLER  K IND               | C      |      2 | VD      |        |
| CONTROLLER  ST A TION  N UMB ER | N      |      4 |         |        |
| TOT A L  LEN G H T              | N      |      4 | 10      |        |
| OPCODE                          | N      |      1 | 0 1 x 9 |        |